{% extends "base.html" %}

{% block title %}Home - Task Manager{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1>Welcome, {{ user.username }}!</h1>
        <div class="d-flex align-items-center gap-3">
            <span class="badge bg-{{ user.get_badge().class }} fs-6">
                <i class="bi bi-award-fill me-1"></i>{{ user.get_badge().name }} Badge
            </span>
            <span class="text-muted">
                <i class="bi bi-star-fill text-warning me-1"></i>{{ user.total_points }} points
            </span>
        </div>
    </div>
    <a href="{{ url_for('add_task') }}" class="btn btn-primary">
        <i class="bi bi-plus-circle-fill me-1"></i>Add New Task
    </a>
</div>

<!-- Task Filters and Sorting -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h6 class="card-subtitle mb-2">Filter Tasks:</h6>
                <div class="btn-group" role="group">
                    <a href="{{ url_for('index', filter='all', sort=request.args.get('sort', 'created_date')) }}" 
                       class="btn btn-outline-primary {{ 'active' if current_filter == 'all' else '' }}">All</a>
                    <a href="{{ url_for('index', filter='pending', sort=request.args.get('sort', 'created_date')) }}" 
                       class="btn btn-outline-primary {{ 'active' if current_filter == 'pending' else '' }}">Pending</a>
                    <a href="{{ url_for('index', filter='completed', sort=request.args.get('sort', 'created_date')) }}" 
                       class="btn btn-outline-primary {{ 'active' if current_filter == 'completed' else '' }}">Completed</a>
                    <a href="{{ url_for('index', filter='overdue', sort=request.args.get('sort', 'created_date')) }}" 
                       class="btn btn-outline-danger {{ 'active' if current_filter == 'overdue' else '' }}">Overdue</a>
                    <a href="{{ url_for('index', filter='upcoming', sort=request.args.get('sort', 'created_date')) }}" 
                       class="btn btn-outline-success {{ 'active' if current_filter == 'upcoming' else '' }}">Upcoming</a>
                </div>
            </div>
            <div class="col-md-6">
                <h6 class="card-subtitle mb-2">Sort By:</h6>
                <div class="btn-group" role="group">
                    <a href="{{ url_for('index', filter=current_filter, sort='created_date') }}" 
                       class="btn btn-outline-secondary {{ 'active' if current_sort == 'created_date' else '' }}">Created Date</a>
                    <a href="{{ url_for('index', filter=current_filter, sort='due_date') }}" 
                       class="btn btn-outline-secondary {{ 'active' if current_sort == 'due_date' else '' }}">Due Date</a>
                    <a href="{{ url_for('index', filter=current_filter, sort='priority') }}" 
                       class="btn btn-outline-secondary {{ 'active' if current_sort == 'priority' else '' }}">Priority</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tasks List -->
{% if tasks %}
<div class="card">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="bi bi-list-task me-2"></i>Your Tasks ({{ tasks|length }})
        </h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th scope="col" width="5%">Status</th>
                        <th scope="col" width="30%">Task</th>
                        <th scope="col" width="15%">Priority</th>
                        <th scope="col" width="15%">Due Date</th>
                        <th scope="col" width="10%">Points</th>
                        <th scope="col" width="25%">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in tasks %}
                    <tr class="{{ 'table-success' if task.status == 'Completed' else 'table-danger' if task.is_overdue() else '' }}">
                        <td>
                            {% if task.status == 'Completed' %}
                                <i class="bi bi-check-circle-fill text-success fs-5"></i>
                            {% else %}
                                <i class="bi bi-circle text-muted fs-5"></i>
                            {% endif %}
                        </td>
                        <td>
                            <div class="{{ 'text-decoration-line-through text-muted' if task.status == 'Completed' else '' }}">
                                <strong>{{ task.title }}</strong>
                                {% if task.description %}
                                    <br><small class="text-muted">{{ task.description[:50] }}{{ '...' if task.description|length > 50 else '' }}</small>
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            <span class="{{ task.get_priority_class() }}">
                                {% if task.priority == 'High' %}
                                    <i class="bi bi-exclamation-triangle-fill me-1"></i>
                                {% elif task.priority == 'Medium' %}
                                    <i class="bi bi-dash-circle-fill me-1"></i>
                                {% else %}
                                    <i class="bi bi-check-circle-fill me-1"></i>
                                {% endif %}
                                {{ task.priority }}
                            </span>
                        </td>
                        <td>
                            {% if task.due_date %}
                                <div>
                                    {{ task.due_date.strftime('%Y-%m-%d') }}
                                    {% if task.is_due_today() %}
                                        <br><span class="badge bg-warning text-dark">Due Today</span>
                                    {% elif task.is_overdue() %}
                                        <br><span class="badge bg-danger">Overdue</span>
                                    {% endif %}
                                </div>
                            {% else %}
                                <span class="text-muted">No due date</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-info">{{ task.points }} pts</span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <a href="{{ url_for('toggle_task', task_id=task.id) }}" 
                                   class="btn btn-outline-{{ 'warning' if task.status == 'Completed' else 'success' }}"
                                   title="{{ 'Mark as pending' if task.status == 'Completed' else 'Mark as completed' }}">
                                    <i class="bi bi-{{ 'arrow-counterclockwise' if task.status == 'Completed' else 'check' }}"></i>
                                </a>
                                <a href="{{ url_for('edit_task', task_id=task.id) }}" 
                                   class="btn btn-outline-primary"
                                   title="Edit task">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{{ url_for('delete_task', task_id=task.id) }}" 
                                   class="btn btn-outline-danger"
                                   title="Delete task"
                                   onclick="return confirm('Are you sure you want to delete this task?')">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<div class="text-center py-5">
    <div class="mb-4">
        <i class="bi bi-clipboard-x display-1 text-muted"></i>
    </div>
    <h3 class="text-muted">No tasks found</h3>
    <p class="text-muted">
        {% if current_filter != 'all' %}
            No tasks match the current filter. <a href="{{ url_for('index') }}">View all tasks</a>
        {% else %}
            Start by adding your first task!
        {% endif %}
    </p>
    <a href="{{ url_for('add_task') }}" class="btn btn-primary btn-lg">
        <i class="bi bi-plus-circle-fill me-2"></i>Add Your First Task
    </a>
</div>
{% endif %}
{% endblock %}
